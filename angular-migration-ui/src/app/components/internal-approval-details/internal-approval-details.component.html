<div class="internal-approval-details">
  <div class="page-header">
    <h1>Internal Approval Details</h1>
    <div class="header-actions">
      <button 
        class="btn btn-secondary" 
        (click)="loadApprovalDetails()" 
        [disabled]="isLoading">
        <i class="fas fa-sync-alt" [class.fa-spin]="isLoading"></i>
        Refresh
      </button>
      <button 
        class="btn btn-primary" 
        (click)="executeApprovalForSelected()" 
        [disabled]="isLoading || selectedItems.size === 0">
        <i class="fas fa-play"></i>
        Execute Selected ({{ selectedItems.size }})
      </button>
      <a class="btn btn-outline-secondary" routerLink="/internal">
        <i class="fas fa-arrow-left"></i>
        Back to Dashboard
      </a>
    </div>
  </div>

  <div class="error-message" *ngIf="error">
    <i class="fas fa-exclamation-triangle"></i>
    {{ error }}
  </div>

  <!-- Filters -->
  <div class="filters-container">
    <div class="filter-group">
      <label for="statusFilter">Status:</label>
      <select 
        id="statusFilter" 
        [(ngModel)]="statusFilter" 
        (change)="onFilterChange()"
        class="form-control">
        <option *ngFor="let option of statusOptions" [value]="option.value">
          {{ option.label }}
        </option>
      </select>
    </div>

    <div class="filter-group">
      <label for="stepFilter">Step:</label>
      <select 
        id="stepFilter" 
        [(ngModel)]="stepFilter" 
        (change)="onFilterChange()"
        class="form-control">
        <option *ngFor="let option of stepOptions" [value]="option.value">
          {{ option.label }}
        </option>
      </select>
    </div>

    <div class="filter-group">
      <label for="searchFilter">Search:</label>
      <input 
        id="searchFilter"
        type="text" 
        [(ngModel)]="searchFilter" 
        (keyup.enter)="onFilterChange()"
        placeholder="Search correspondences..."
        class="form-control">
    </div>

    <button class="btn btn-outline-primary" (click)="onFilterChange()">
      <i class="fas fa-search"></i>
      Search
    </button>
  </div>

  <!-- Approval Details Table -->
  <div class="table-container">
    <table class="details-table">
      <thead>
        <tr>
          <th>
            <input 
              type="checkbox" 
              [checked]="isAllSelected()" 
              (change)="toggleSelectAll()"
              [disabled]="isLoading">
          </th>
          <th>Correspondence GUID</th>
          <th>Subject</th>
          <th>Reference No</th>
          <th>Document ID</th>
          <th>Approval Step</th>
          <th>Status</th>
          <th>Retry Count</th>
          <th>Last Modified</th>
          <th>Error</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let detail of approvalDetails" [class.selected]="isSelected(detail.correspondenceGuid)">
          <td>
            <input 
              type="checkbox" 
              [checked]="isSelected(detail.correspondenceGuid)" 
              (change)="toggleSelection(detail.correspondenceGuid)"
              [disabled]="isLoading">
          </td>
          <td class="guid-cell">{{ detail.correspondenceGuid }}</td>
          <td class="subject-cell">{{ detail.correspondenceSubject || 'N/A' }}</td>
          <td>{{ detail.correspondenceReferenceNo || 'N/A' }}</td>
          <td class="document-id-cell">{{ detail.createdDocumentId || 'N/A' }}</td>
          <td>
            <span class="step-badge" [class]="getStepClass(detail.approvalStep)">
              {{ detail.approvalStep }}
            </span>
          </td>
          <td>
            <span class="status-badge" [class]="getStatusClass(detail.approvalStatus)">
              {{ detail.approvalStatus }}
            </span>
          </td>
          <td class="retry-count">{{ detail.retryCount }}</td>
          <td class="date-cell">{{ detail.lastModifiedDate | date:'short' }}</td>
          <td class="error-cell">
            <span *ngIf="detail.approvalError" class="error-text" [title]="detail.approvalError">
              {{ detail.approvalError.length > 50 ? (detail.approvalError | slice:0:50) + '...' : detail.approvalError }}
            </span>
            <span *ngIf="!detail.approvalError">-</span>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="no-data" *ngIf="!isLoading && approvalDetails.length === 0">
      <i class="fas fa-inbox"></i>
      <p>No internal approval details found</p>
    </div>

    <div class="loading" *ngIf="isLoading">
      <i class="fas fa-spinner fa-spin"></i>
      <p>Loading internal approval details...</p>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination-container" *ngIf="totalPages > 1">
    <div class="pagination-info">
      Showing {{ currentPage * pageSize + 1 }} to {{ Math.min((currentPage + 1) * pageSize, totalElements) }} of {{ totalElements }} entries
    </div>
    
    <div class="pagination">
      <button 
        class="btn btn-outline-secondary" 
        (click)="onPageChange(currentPage - 1)"
        [disabled]="!hasPrevious || isLoading">
        <i class="fas fa-chevron-left"></i>
        Previous
      </button>
      
      <button 
        *ngFor="let page of getPaginationArray()"
        class="btn"
        [class.btn-primary]="page === currentPage"
        [class.btn-outline-secondary]="page !== currentPage"
        (click)="onPageChange(page)"
        [disabled]="isLoading">
        {{ page + 1 }}
      </button>
      
      <button 
        class="btn btn-outline-secondary" 
        (click)="onPageChange(currentPage + 1)"
        [disabled]="!hasNext || isLoading">
        Next
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>
</div>